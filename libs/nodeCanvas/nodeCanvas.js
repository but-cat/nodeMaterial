var NodeCanvas=function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"PointIn",(function(){return u})),n.d(e,"PointOut",(function(){return h})),n.d(e,"NodeBlock",(function(){return l})),n.d(e,"toLowerLine",(function(){return c})),n.d(e,"Connect",(function(){return v}));Object.create;Object.create;function o(t,e,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(t):o?o.value:e.get(t)}var i;class s extends HTMLElement{constructor(){super(...arguments),i.set(this,new Map)}get RootNode(){return console.log("getRootNode: ",this.getRootNode()),this.getRootNode().host}static getTripple(t){const e="observedAttributeConfig",n=(null==t?void 0:t[e])&&Array.isArray(null==t?void 0:t[e])?null==t?void 0:t[e]:[];return[..."element-prototype"===(null==t?void 0:t.tagName)?s.getTripple(Object.getPrototypeOf(t)):[],...n].flat(1/0)}static useNode(t,e){const n=s.getTripple(t).map(t=>["string"==typeof t?t:t.property,t]).reverse(),o=new Map(n);t.observedAttributes=[...o.keys()],t.observedAttributeConfig=[...o.values()],console.log(`节点 ${e} 开始注册`,!!customElements.get(e)),customElements.get(e)||(customElements.define(e,t),b.nodeList.set(e,t))}hasEventListener(t,e){let n=o(this,i,"f").get(t);return Boolean(null==n?void 0:n.has(e))}addEventListener(t,e,n){let s=o(this,i,"f").get(t);s||(s=new Set,o(this,i,"f").set(t,s)),null==s||s.add(e),super.addEventListener(t,e,n)}removeEventListener(t,e,n){const s=o(this,i,"f").get(t)||new Set;null==s||s.delete(e),super.removeEventListener(t,e,n)}dispatchEvent(t){const e=t instanceof Event?t:new Event(t.type,t);return delete t.type,t instanceof Event||Object.keys(t).forEach(n=>e[n]=t[n]),super.dispatchEvent(e)}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}}function r(t){if("object"==typeof t){let e=t.start.x+" "+t.start.y;t.end.x,t.end.y;return"M"+e+function(t){const e=t.start,n=t.end,o=Math.abs(n.x-e.x),i=e.x+o/2,s=n.x-o/2,r=e.y,a=n.y;return` C ${i} ${r}, ${s} ${a}, ${n.x} ${n.y} `}(t)}}function a(t,e){let n=t.offsetTop,o=t.offsetLeft,i=t.parentElement,s=t.offsetParent;for(;i&&(i&&s&&i===s&&(n+=i.offsetTop,o+=i.offsetLeft,s=s.offsetParent),i=i.parentElement,!e||!(null==i?void 0:i.matches(e))););const r=t.offsetWidth/2;return{top:n+t.offsetHeight/2,left:o+r}}function c(t){var e=t.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));return"-"===e.slice(0,1)&&(e=e.slice(1)),e}function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}i=new WeakMap,s.observedAttributes=[],s.observedAttributeConfig=["src"],s.tagName="ElementPrototype";class u extends s{setPoint(t){const e=t;(null==e?void 0:e.uuid)!=this.getAttribute("out")&&(e instanceof h?(this.setAttribute("out",e.uuid),this.pointOut=e):(this.removeAttribute("out"),this.pointOut=void 0))}constructor(){super(),this.uuid=d(),this.start={x:0,y:0},this.end={x:0,y:0},this.active=!1,this.addEventListener("pointerdown",this.pointerdown.bind(this))}connectedCallback(){queueMicrotask(()=>this.dispatchEvent(new CustomEvent("connected-init",{bubbles:!0,composed:!0}))),null===this.getAttribute("id")?this.setAttribute("id",this.uuid):this.uuid=this.getAttribute("id")}disconnectedCallback(){this._root.dispatchEvent(new CustomEvent("connected-del",{detail:{el:this},bubbles:!0,composed:!0})),this._root=void 0}attributeChangedCallback(t,e,n){"id"==t&&(this.uuid=n),"out"==t&&queueMicrotask(()=>{var t;if(!n)return this.pointOut=void 0,this.removeAttribute("out"),void this.dispatchEvent(new CustomEvent("connected-del",{bubbles:!0,composed:!0}));if(n==(null===(t=null==this?void 0:this.pointOut)||void 0===t?void 0:t.uuid))return;const e=document.getElementById(n);this.pointOut&&this.pointOut==e||this.dispatchEvent(new CustomEvent("connected-to",{detail:{pointIn:this,pointOut:e},bubbles:!0,composed:!0}))})}pointerdown(t){t.preventDefault(),t.stopPropagation();const e=t.pointerId;if(!this.pointOut)return;const n=this.pointOut;this.dispatchEvent(new CustomEvent("connected-del",{bubbles:!0,composed:!0}));let o=0,i=0;this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.active=!0;const s=t.currentTarget;s.setPointerCapture(t.pointerId);const r=a(n,"node-canvas"),c=a(this,"node-canvas");this.dispatchEvent(new CustomEvent("connected-down",{detail:{pointOut:n,start:{x:r.left,y:r.top},end:{x:c.left,y:c.top}},bubbles:!0,composed:!0})),s.onpointermove=t=>{o+=t.movementX,i+=t.movementY,this.start.x=r.left,this.start.y=r.top,this.end.x=o+c.left,this.end.y=i+c.top,this.dispatchEvent(new CustomEvent("connected-move",{detail:{pointOut:n,start:this.start,end:this.end},bubbles:!0,composed:!0}))};const d=t=>{s.releasePointerCapture(e),s.onpointermove=null,this.active=!1,this.dispatchEvent(new CustomEvent("connected-up",{bubbles:!0,composed:!0}));const o=document.elementFromPoint(t.clientX,t.clientY);(null==o?void 0:o.matches("point-in"))&&((null==o?void 0:o.hasAttribute("disabled"))||n.getAttribute("type")&&o.getAttribute("type")!==n.getAttribute("type")||(this.dispatchEvent(new CustomEvent("connected-to",{detail:{pointIn:o,pointOut:n},bubbles:!0,composed:!0})),window.removeEventListener("pointerup",d)))};window.addEventListener("pointerup",d,{once:!0})}}u.tagName="point-in",u.observedAttributeConfig=[{type:"string",property:"out",value:""},{type:"string",property:"type",value:""},{type:"string",property:"id",value:""}];class h extends s{setPoint(t){}constructor(){super(),this.uuid=d(),this.start={x:0,y:0},this.end={x:0,y:0},this.active=!1,this.addEventListener("pointerdown",this.pointerdown.bind(this))}connectedCallback(){queueMicrotask(()=>this.dispatchEvent(new CustomEvent("connected-init",{bubbles:!0,composed:!0}))),null===this.getAttribute("id")?this.setAttribute("id",this.uuid):this.uuid=this.getAttribute("id")}disconnectedCallback(){this._root.dispatchEvent(new CustomEvent("connected-del",{detail:{el:this},bubbles:!0})),this._root=void 0}attributeChangedCallback(t,e,n){"id"==t&&(this.uuid=n)}pointerdown(t){if(this.hasAttribute("disabled"))return;t.preventDefault(),t.stopPropagation();const e=t.pointerId;let n=0,o=0;this.active=!0;const i=t.currentTarget;i.setPointerCapture(t.pointerId),this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.dispatchEvent(new CustomEvent("connected-down",{detail:{pointOut:this,start:this.start,end:this.end},bubbles:!0,composed:!0}));const s=a(this,"node-canvas");i.onpointermove=t=>{n+=t.movementX,o+=t.movementY,this.start.x=s.left,this.start.y=s.top,this.end.x=n+s.left,this.end.y=o+s.top,this.dispatchEvent(new CustomEvent("connected-move",{detail:{pointOut:this,start:this.start,end:this.end},bubbles:!0,composed:!0}))};const r=t=>{i.releasePointerCapture(e),i.onpointermove=null,this.active=!1,this.dispatchEvent(new CustomEvent("connected-up",{bubbles:!0,composed:!0}));const n=document.elementFromPoint(t.clientX,t.clientY);(null==n?void 0:n.matches("point-in"))&&(n.hasAttribute("disabled")||this.getAttribute("type")&&n.getAttribute("type")!==this.getAttribute("type")||(this.dispatchEvent(new CustomEvent("connected-to",{detail:{pointIn:n,pointOut:this},bubbles:!0,composed:!0})),window.removeEventListener("pointerup",r)))};window.addEventListener("pointerup",r,{once:!0})}}h.tagName="point-out",h.observedAttributes=["in","type"];class l extends s{get x(){return this._x}set x(t){this._x=t,this.style.left=t+"px"}get y(){return this._y}set y(t){this._y=t,this.style.top=t+"px"}constructor(){super(),this.uuid=d(),this._x=0,this._y=0,this.active=!1,this.addEventListener("pointerdown",this.pointerdown.bind(this))}connectedCallback(){super.connectedCallback(),queueMicrotask(()=>this.dispatchEvent(new CustomEvent("connected-init",{bubbles:!0,composed:!0}))),this.style.position="absolute";const t=[...this.getAttribute("position").split(",")].map(t=>Number(t));this.x=t[0],this.y=t[1]}disconnectedCallback(){this._root.dispatchEvent(new CustomEvent("connected-del",{detail:{el:this},bubbles:!0})),this._root=void 0}pointerdown(t){t.preventDefault();const e=t.pointerId,n=t.currentTarget;n.setPointerCapture(t.pointerId),n.onpointermove=t=>{this.x+=t.movementX,this.y+=t.movementY,n.dispatchEvent(new CustomEvent("connected-update",{bubbles:!0,composed:!0}))};const o=()=>{n.releasePointerCapture(e),n.onpointermove=null,this.active=!1,n.removeEventListener("pointerup",o)};n.addEventListener("pointerup",o,{once:!0})}getConnectedList(){this.querySelectorAll("point-in"),this._root.connect}attributeChangedCallback(t,e,n){if("position"==t){const t=[...n.split(",")].map(t=>Number(t));this.x=t[0],this.y=t[1]}}}l.tagName="node-block",l.observedAttributes=["in"];class p extends s{get x(){return this.scrollLeft}set x(t){this._x=t,this.scrollLeft=-t}get y(){return this.scrollTop}set y(t){this.scrollTop=-t}constructor(){super(),this.uuid=d(),this._x=0,this._y=0,this.active=!1,this.addEventListener("pointerdown",this.pointerdown.bind(this)),document.addEventListener("keydown",t=>{if(!this.active)switch(t.key.toLowerCase()){case" ":t.stopPropagation(),t.preventDefault(),this.active=!0,this.setAttribute("active","")}}),document.addEventListener("keyup",t=>{this.active=!1,this.removeAttribute("active")}),window.addEventListener("pointerup",t=>{this.active=!1,this.removeAttribute("active")}),window.addEventListener("blur",t=>{this.active=!1,this.removeAttribute("active")}),this.addEventListener("mousewheel",t=>{const e=t;if(e.stopPropagation(),e.preventDefault(),!this.active)return;let n=e.deltaX,o=e.deltaY;this.scrollBy(n,o)})}connectedCallback(){super.connectedCallback(),queueMicrotask(()=>this.dispatchEvent(new CustomEvent("connected-init",{bubbles:!0,composed:!0}))),this.style.display="block"}disconnectedCallback(){this._root=void 0}pointerdown(t){if(!this.active)return;t.preventDefault();t.pointerId;this.setPointerCapture(t.pointerId),this.onpointermove=t=>{this.scroll({top:this.scrollTop-t.movementY,left:this.scrollLeft-t.movementX,behavior:"auto"}),this.dispatchEvent(new CustomEvent("connected-update",{bubbles:!0,composed:!0}))},this.addEventListener("pointerup",this.moveUp.bind(this),{once:!0})}moveUp(){const{pointerId:t}=this;t&&this.releasePointerCapture(t),this.onpointermove=null,this.pointerId=void 0,this.removeEventListener("pointerup",this.moveUp.bind(this))}getConnectedList(){this.querySelectorAll("point-in"),this._root.connect}attributeChangedCallback(t,e,n){if("position"==t){const t=[...n.split(",")].map(t=>Number(t));this.x=t[0],this.y=t[1]}}}p.tagName="node-container",p.observedAttributes=["in"];class v extends Array{constructor(){super(),this.PointIN=new WeakMap,this.PointOUT=new WeakMap,this.PointLine=new WeakMap,this.PointInLine=new WeakMap}add(t,e){if(!(t instanceof u))throw new Error("pointIn is not PointIn");if(!(e instanceof h))throw new Error("pointOut is not PointOut");const n=document.createElementNS("http://www.w3.org/2000/svg","path");if(this.has(t,e)&&this.delete(t),this.push(t,e),this.PointIN.set(t,e),this.PointOUT.has(e)){const n=this.PointOUT.get(e);null==n||n.add(t)}else{const n=new Set;n.add(t),this.PointOUT.set(e,n)}this.PointLine.set(t,n),this.PointInLine.set(n,t),t.setPoint(e),e.setPoint(t);const{left:o=0,top:i=0}=a(t,"node-canvas"),{left:s=0,top:c=0}=a(e,"node-canvas");return n.setAttribute("d",r({start:{x:s,y:c},end:{x:o,y:i}})),n}has(t,e){if(this.PointIN.has(t)){if(this.PointIN.get(t))return!0}return!1}delete(t){if(!(t instanceof u))throw!1;const e=t,n=this.PointIN.get(t),o=this.PointLine.get(e);if(!e||!n||!o)return!1;e.setPoint(),this.PointIN.delete(e),n.setPoint();const i=this.PointOUT.get(n);return i?i.delete(e):this.PointOUT.delete(n),this.PointLine.delete(e),this.splice(this.indexOf(e),1),this.splice(this.indexOf(n),1),o.remove(),!0}updataLine(t=[]){t.map(t=>[...this.getPointLine(t)]).flat(1).filter(Boolean).forEach(t=>{const e=this.PointInLine.get(t),n=this.PointIN.get(e),{left:o=0,top:i=0}=a(e,"node-canvas"),{left:s=0,top:c=0}=a(n,"node-canvas");t.setAttribute("d",r({start:{x:s,y:c},end:{x:o,y:i}}))})}push(...t){return super.push(...t)}getPoint(t){let e=t.tagName==="point-in".toUpperCase()?t:this.PointOUT.get(t);const n=t.tagName==="point-out".toUpperCase()?t:this.PointIN.get(t);return Boolean(e&&n)?{pointIn:e,pointOut:n}:void 0}getPointLine(t){const e=new Set;if(t.tagName==="point-in".toUpperCase()){const n=t,o=this.PointLine.get(n);e.add(o)}else if(t.tagName==="point-out".toUpperCase()){const n=t,o=this.PointOUT.get(n);null==o||o.forEach(t=>{const n=this.PointLine.get(t);e.add(n)})}return e}getPointInList(){return super.filter(t=>this.PointIN.has(t))}getPointOutList(){return super.filter(t=>this.PointOUT.has(t))}getPointSet(t){const e=this.PointOUT.get(t);return e?[...e]:[]}connectedUUID(t){return this.PointIN.has(t)?[t.uuid,this.PointIN.get(t).uuid]:void 0}}class b extends s{static useNode(t,e){const n=e||c(t.tagName);b.nodeList.has(n)?console.warn(`节点 ${n} 已注册`):super.useNode(t,n)}get zoom(){return this._zoom}set zoom(t){this._zoom=t,this.style.zoom=this.getAttribute("zoom")||"1.0"}get connectedList(){return this.connect.filter(t=>t instanceof u).map(t=>this.connect.connectedUUID(t))}constructor(){super(),this._zoom=1,this.connect=new v,this.action=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.actionPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.line=document.createElementNS("http://www.w3.org/2000/svg","svg");const t=this.attachShadow({mode:"open"});this.action.style.width="100%",this.action.style.height="100%",this.action.style.position="absolute",this.action.style.top="0",this.action.style.left="0",this.actionPath.style.cssText="display: none;\nstroke-width: 4px;\nfill: transparent;\nopacity: 0.5;\nstroke: #5ef11a;\n",this.action.appendChild(this.actionPath),t.appendChild(this.action);const e=document.createElement("slot");t.appendChild(e),this.addEventListener("connected-down",this.connectedPath.bind(this)),this.addEventListener("connected-move",this.connectedPath.bind(this)),this.addEventListener("connected-up",this.connectedPath.bind(this)),this.addEventListener("connected-to",t=>{t.preventDefault();const{pointIn:e,pointOut:n}=t.detail;this.connectedTo(e,n)}),this.addEventListener("connected-update",t=>{const e=t.target.querySelectorAll("point-in, point-out");this.connect.updataLine([...e].filter(Boolean))}),this.addEventListener("connected-del",t=>{var e;const n=(null===(e=t.detail)||void 0===e?void 0:e.el)?t.detail.el:t.target;if(n instanceof u)this.connect.delete(n);else if(n instanceof h){const t=this.connect.getPointSet(n);t&&t.forEach(t=>{this.connect.delete(t)})}}),this.addEventListener("connected-init",t=>{const e=t.target;e instanceof s&&(e._root=this)})}attributeChangedCallback(t,e,n){"zoom"==t&&(this.zoom=parseFloat(n))}connectedCallback(){super.connectedCallback(),this.style.position="relative",this.style.zoom=this.getAttribute("zoom")||"1.0"}connectedPath(t){if("connected-move"===t.type){const e=t.detail.pointOut.getAttribute("type");this.actionPath.style.display="block",e&&this.setAttribute("type",e);const n=t.detail.start,o=t.detail.end;this.actionPath.setAttribute("d",r({start:n,end:o}))}else"connected-up"===t.type&&(this.actionPath.style.display="none",this.removeAttribute("type"))}connectedTo(t,e){if(!(t instanceof u))return;if(!(e instanceof h))return;if(this.connect.has(t,e))return;const n=this.connect.add(t,e);return n.style.width="100%",n.style.height="100%",n.style.cssText="\n\t\tstroke-width: 4px;\n\t\tfill: transparent;\n\t\tstroke: #5ef11a;\n\t\tstrokeDasharray: 5, 5;\n\t\tstrokeDashoffset: 0;\n\t\tstrokeLinecap: round;",t.dispatchEvent(new CustomEvent("connected-change")),this.action.appendChild(n),n}getConnectedList(t){const e=new Set;t.forEach(t=>{t instanceof u?e.add(t):t instanceof h&&this.connect.getPointSet(t).forEach(t=>e.add(t))});const n=[];return e.forEach(t=>{n.push(this.connect.connectedUUID(t))}),n.filter(Boolean)}}b.tagName="node-canvas",b.nodeList=new Map,b.observedAttributeConfig=[{type:"number",property:"zoom",value:1}],[u,h,l,p,b].forEach(t=>{l.useNode(t,c(t.tagName))}),console.log("%cNode Block%cversion v0.0.1","color: #607d8b;background-color: #e6e5e5; border-radius: 3px 0 0 3px;padding: .2em .4em;box-shadow: 0 0 4px rgb(212, 212, 212, 0.4);","color: #ffce1d;background-color: #607d8b; border-radius: 0 3px 3px 0;padding: .2em .4em;box-shadow: 0 0 4px rgb(212, 212, 212, 0.4);");e.default=b}]);void 0===NodeCanvas&&console.error("esm-webpack-plugin: nothing exported!");export default NodeCanvas.default;const _NodeCanvas$PointIn=NodeCanvas.PointIn,_NodeCanvas$PointOut=NodeCanvas.PointOut,_NodeCanvas$NodeBlock=NodeCanvas.NodeBlock,_NodeCanvas$toLowerLine=NodeCanvas.toLowerLine,_NodeCanvas$Connect=NodeCanvas.Connect;export{_NodeCanvas$PointIn as PointIn,_NodeCanvas$PointOut as PointOut,_NodeCanvas$NodeBlock as NodeBlock,_NodeCanvas$toLowerLine as toLowerLine,_NodeCanvas$Connect as Connect};